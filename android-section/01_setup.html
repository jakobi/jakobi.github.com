<HTML>
<HEAD>
<link rel="icon"          href="/favicon.png"/>
<link rel="shortcut icon" href="/favicon.png"/>
<meta name="description" content="Coping with Android - Setup as a Unix Box: survival unix shell chroot debian ubuntu google android tutorial samsung galaxy note vnc X11 xvnc bash office arm armel">
<meta name="keywords" content="coping android setup as unix box survival shell chroot debian ubuntu google tutorial samsung galaxy note vnc xvnc bash office arm armel">
<meta name="author" content="Peter Jakobi">
<TITLE>Coping with Android - Setup as a Unix Box</TITLE>
<style type="text/css"><!--
   .anno { font-size:.8em }
--></style>
<style type="text/css"><!--
   .num { padding-left:1em; text-align:right; nopadding-right:1em}
   .repo{ text-align:center}
   .file{ nopadding-left:1em; font-family:monospace}
.desc{ padding-left:2em}
--></style>
</HEAD>

<BODY style="background-color:#ffffee">

<p class=anno>
<a href="http://jakobi.github.com/">HOME</a>                                          &nbsp;|&nbsp; 
<a href="http://github.com/jakobi/">GIT Overview</a>          &nbsp;|&nbsp;
Script-Archive:
<a href="/script-archive-doc/">(docs)</a> : 
<a href="http://wiki.github.com/jakobi/script-archive/">(wiki)</a> : 
<a href="http://github.com/jakobi/script-archive">(git)</a>    &nbsp;|&nbsp;
Android:
<a href="http://jakobi.github.com/android-section/">(articles)</a> :
<a href="http://github.com/jakobi/script-archive/tree/master/android">(files)</a> &nbsp;|&nbsp;
...
</p>

<H1>Coping with Android - Setup as a Unix Box</H1>

<hr>

<p>Also                  see                  the                   <a href="http://github.com/jakobi/script-archive/tree/master/android">Android
directory  of  the  script-archive</a>.</p>

<p>Besides some scripts, this directory contains a mothballed snapshot
of  my working Android environment intended to complement the articles
below (android-setup-example-files.tgz).</p>

<p>In  it  you  find the scripts for the Android  shell,  a
collection  of static armel binaries, the tree structure of the chroot
on  the  Galaxy note, as well as scripts and configuration files  used
for monitoring, backup, etc from a remote linux server via cron.</p>

<p>Current  versions of the more interesting scripts will be placed in
above   directory   (if   Android-specific)  or   elsewhere   in   the
script-archive (parts of my bash/ksh setup or generic Unix stuff).</p>



<hr>
<a href="01_setup.html"><H2>01 - Setting  up  the Samsung Galaxy Note as a Unix  Box</H2></a>

<p  class=anno><i>(or  at  least as much as we can get away  with,  given
Google's  Linux kernel  patches and dumbed-down kernel configuration)</i></p>

<H3>Table of contents</H3>
<a name=toc></a>
<ul>
<li><a href="#firstlook">A first look at the Note / Web-Resources / Rooting</a>
<li><a href="#shell">Adding Unix Standards to the Android Shell</a>
<li><a href="#chroot">CHROOT and Turning the Android into a First Class LAN Citizen</a>
<li><a href="#vnc">Desktop and X11</a>
</ul>

<p>
State described: Android 2.3.6 (Gingerbread)<BR>
Last change: 20120216<BR>
License: CC-BY-SA.
</p>



<hr>
<p>Still polishing notes - version 1 to be online before 20120220</p>



<hr>
<a name=firstlook></a>
<H3>A first look at the Note / Web-Resources / Rooting</H3>

<p>This  article  sketches  a sane setup of GNU/Linux on  an  ordinary
<B>1-GB-RAM   DUAL-CORE  PC</B>  (henceforth  to  called   the   armel
architecture  Android device <b>Samsung Galaxy Note</b>).

<p>This is more than enough for a moderate desktop pc that is not used
for  heavy  gaming, virtualization or video editing. In this  article,
I'm     not     interested    in    audio/video    input/output     or
phone/s-pen/sensor/camera  use.</p>

<p><b>I/O options</b> include</p>
<ul>
<li>the OTG USB Port, which permits to connect
<ul>
<li> the Note to the PC (adb, access to 
    the Note's FAT user filesystems) or
<li> some external USB hardware
    to the Note (Mouse/Keyboard/Memory stick, etc, as long an in-kernel
    driver is available)
<li>HDMI Connection cable (as it reuses the physical OTG port :))
</ul>
<li>acting as either a WLAN-client or a WLAN Access Point
<li>networking over USB
<li>the S-pen - a real wacom-style stylus offering pressure-sensitivity
    and high resolution (not one of those useless iphone-style capacitive 
    finger-tip-replacements; better quality tablet-pc pens work
    on the Note offering both eraser and stylus)
<li>...
</ul>

<p><b>Flash  considerations</b>:  Choose a quality sdhc microsd flash, 16  or
32GB.  After  bad experiences with both Class 10 Transcent and  Lexar,
I've  now settled on a reliable Sandisk class 4 16GB microsd flash. As
Sandisk  chooses  labels  according to the minimum write rate,  it  is
nearly  as fast as the others. One advantage is that I no longer  find
the  chroot remounted read-only, as this means to shutdown/restart the
chroot and running fsck (no loss of data though). When switching I had
a  look  at  the FAT and it's titanium backup and found  massive  data
corruption. Read speeds for the internal flash are 50+ MB/s and 18MB/s
for  Sandisk (20MB/s also happens to be the maximum to expect with any
USB 2.0 card reader).</p>

<p><i>Do  update and validate titanium backups (doubly so on  external
sdcards) before flashing new firmware. Copy the backups to
your PC (e.g. as port of a nightly backup schedule).</i>.</p>

<p><b>Power  considerations</b>:  Enable automatic battery savings  in
Settings. Turn off WLAN and GPS - the location by cell towers is still
pretty exact. If necessary, you can also use titanium backup to freeze
some of the more annoying apps in your firmware (kies, socialhub).</p>

<p><b>Things to avoid</b>:</p>
<ul>
<li>voice assistance / voice input (ICS should improve things).
<li>use of app2sd: do move all apps to the phone (/data) - the core of
    the Android framework has <B>MAJOR PROBLEMS</B> with apps on sdcards,
    upto and including hanging in a boot-loop (recover by full wipe or
    by adb shell from the PC and removing any packages on the sdcards;
    access by ssh with sshdroid is not possible).
</ul>



<h4>Why Rooting</H4>

Besides  getting faster access to upstream security and bug fixes than
by  waiting for something to trickle down rom Google to Hardware Maker
to Provider to OTA distribution, rooting enables more options for

<ul>
<li>backup/restore
<li>battery management
<li>privacy (LBA, aspotcat, ...; personal firewalls)
<li>routing (improved tethering and intelligent "routing" at ip route/iptables level)
<li>security (lookout, avast; access to iptables and real firewalls)
<li>access to non-Android programs, for the Android shell or for a chroot
    maybe containing a full DEBIAN or Ubuntu.
</ul>

Depending  on how you root the device, the flash counter may  increase
(the                                                                <a href="http://forum.xda-developers.com/showthread.php?t=1354888">301K
resistor  fieldtesting jig</a> might help). But in case of mailing  in
the  device, you need to reflash a stock firmware anyway. In  summary:
so what.




<h4>Research Phase</h4>


<ul>
<li><a href="http://www.androidnz.net/2011/12/samsung-galaxy-note-complete-review.html">AndroidNZ review with some app suggestions</a>
<li><a href="http://forum.xda-developers.com/forumdisplay.php?f=1349">XDA Note forum</a>
</ul>



<h4>Pre-Flashing Checklist</h4>




<h4>Rooting sketch</h4>


<pre>
Odin (Windows, forget the version chaos and choose one that mentions Galaxy Note N7000), 
Heimdall (Linux, untested): in case mobile Odin/CFROOT is unavailable/insufficient for flashing

install ODIN on a windows pc
install initial cwm/cfroot with an early rom
install install rooted custom rom of your choice with cfroot/cwm.
</pre>


<h4>Post Flashing Checklist</H4>





<h4>Software</h4>

<p>1. Nice to have market apps to improve on Android graphical offerings:</p>
<ul>
<li>aspotcat, lookout, lbe privacy guard (security, permissions, receivers, intents)
<li>clipper, clip ninja, floatmemo (without a window system, we need help to transfer data between apps)
<li>clocksync (to keep your clock in sync with NTP)
<li>coolapps (system load widget and much more)
<li>jota (nice text editor)
<li>mobile odin
<li>printbot, scanthing (printing and scanning, with OCR via update to google docs)
<li>ringguard (don't accidentally change ring tone loudness)
<li>smart taskswitcher, task manager
<li>tasker (programmable android event handling, can substitute for cron, can turn on/off WLAN depending on location, etc)
<li>terminal emulator
<li>zdbox (task killing, moving apps from sdcard to phone)
</ul>

<p  class=anno>(voice recognition and more than word-level handwriting
recognition aren't quite there yet in gingerbread)</p>


<p>2. Required market apps for the rest of this article:</p>
<ul>
<li>busybox installer
<li>connectbot (use ssh to connect to remote systems)
<li>fileexpert or any other filemanager capable of accessing non-sdcard directories
<li>sshdroid (permit incoming ssh connections, dropbear-based)
<li>superuser (usually part of the custom firmware we install)
<li>terminal ide (a pretty complete unix user space for the Android shell)
<li>titanium backup (backup and restore apps, also offers dealing with offending (firmware) apps)
<li>xvnc or vnc viewer
<li>mostly optional: <a href="http://code.google.com/p/android-scripting/">sl4a and perl</a> (perl/python/lua wrapper
    examples are availble for use of the languages in the Android shell; some of my scripts may require perl)
</ul>

<p class=anno>(there  also  are one or two apps that may simplify setting  up  the
chroot   for  sections  3  and  4  of  this  article  (market:   Linux
installer))</p>


<p>3. PC-side applications</p>
<ul>
<li>adb (in the <a href="http://developer.android.com/sdk">Android SDK</a>, tools directory; <b>Warning</b>: never use symlinks on the Android side of a path - it silently fails)
</ul>




<!-- ------------------------------------------------------------------------------------- -->
<hr><a href="#toc">(table of contents)</a><hr>
<a name=shell></a>
<H3>Adding Unix Standards to the Android Shell</H3>


<-- -------------------------^^^ clean \/\/\/ borked ---------------------------------------------------------------- -->

<pre>
The  second  part describes setting up enough of a real  Unix  user
space to actually permit proper use of the shell.

using root / adb:
- vim
- bash (found static)                    *
- mc (found static)                      * <- in an apkg installer
- strace (found static binary)           *
after running iterminal-ide, also:            
- tmux


if necessary insmod logger.ko

TERMIDE
BUSYBOX
SSHDROID

VPN

# openssh5.8p2 (what was my issue here???)
/data/data/org.sshtunnel.beta/sshtunnel

# dropbear
/data/data/com.spartacusrex.spartacuside/files/system/bin/ssh
/data/data/berserker.android.apps.sshdroid/dropbear/ssh

already working:

tethering: just modprobe usbnet and use usb0.
alternately use the ap mode and wlan
proxies: sshtunnel, ORBOT.


try not to mix busybox versions or GNU.

running a script with busybox sh and using e.g. a GNU grep within a pipe
also containing busybox commands may create write failures (busybox has
to take shortcuts in setting up pipes to cope with crippled kernels)

do  NOT use toolbox aka /system/bin/sh for real shell scripts, as  PWD
handling,   $0  and  other  stuff  is  rather  questionable   (writing
CHROOT.run I did run into at least 2 such bugs).

creating a mess: fail to maintain standard configuration and create a new one:
- bionic (lacking) / getprop/ setprop: the Google way.
- various libc implementations: the Unix way, e.g. /etc/resolv.conf

results in interesting breakage: TERMIDE's busybox e.g. lacks DNS-resolving,
Depending on lacking libraries libnss_dns.so does disable the rest.

Only running Busybox-Installer (market) to install busybox into /system/xbin
permits you to do DNS lookups. 

in the end I'm using a iresolver alias to reorder path when I need DNS when using TERMIDE.


</pre>



<!-- ------------------------------------------------------------------------------------- -->
<hr><a href="#toc">(table of contents)</a><hr>
<a name=chroot></a>
<H3>CHROOT and Turning the Android into a First Class LAN Citizen</H3>

<pre>


shortcoming: no kernel updates / no security fixes / as 3D/GPU stuff and
e.g. camera often involve binary firmware blobs, choice of kernel is further limited, if you want
to retain access to the by-design-crippled devices.

security  and maintainability is certainly not comparable to a  native
debian install, where the kernel is properly select by grub on boot, as we're restricted
to mere userspace.

---

note: debian or ubuntu armhf port (efficient support of FPU)
I had a look at the new armhf debian architecture to be, but the repo I used was
too incomplete to even survive debootstrap stage 1.

Building  on these basics, the third part looks at taking a  fully
customized  desktop  setup on the road: Create a  Desktop-size  DEBIAN
armel  CHROOT setup and make that a first class citizen in any LAN you
encounter  (ssh, file serving and filesystem mounting).
</pre>



<!-- ------------------------------------------------------------------------------------- -->
<hr><a href="#toc">(table of contents)</a><hr>
<a name=vnc></a>
<H3>Desktop and X11</H3>


<pre>


The  final  step is running a local X11 Desktop on the Note,  using
the  chroot's vncserver or Xvnc (market: Xvnc). To access, either  use
the local display of the Note or any PC with a vncviewer.

This  setup  is  enough  for  normal  LibreOffice  text
editing,   programming  or  some  light  web  browsing  (firefox9  and
chromium-browser  fail,  iceweasel/firefox  3.5 and  the  webkit/gecko
based  browsers  work), even without swap: I've usually  beyond  350MB
free  (free+buffers+cache) before starting X, which is enough for X11,
some xterms, firefox and LibreOffice.

Q: consider some encrypted loop mount ???

My  suspicions  on being very careful wrt using swap: SSD should  have
flash  translation layers (if cheaper flash actually has that at all):
A FAT fielsystem is simle (only the first few blocks are rewritten all
the  time). Database transaction logs are even simpler (all blocks get
rewritten  in sequence, so "wear and tear" is balanced) - both  permit
trivial  flash translation layers, or actually coping without any. Now
swap  and filesystem journals are differing: rist select a semi-random
set of blocks, and then rewrite them all the time.

Suggestion:  enable  swap  with  a very  stringent  swappiness  value;
despite  speed and quality differences, place swap (if at all) on  the
external sdcard, and only activate it when required.



the frequent firmware updates of quality vendors for all early ssd shows the severity of the issues wrt Flash.


</pre>



<!-- ------------------------------------------------------------------------------------- -->
<hr><a href="#toc">(table of contents)</a><hr>
<p>Back to the <a href="index.html">Android Section Overview</a>.</p>

<hr>
<p class=anno>
<a href="http://jakobi.github.com/">HOME</a>                                          &nbsp;|&nbsp; 
<a href="http://github.com/jakobi/">GIT Overview</a>          &nbsp;|&nbsp;
Script-Archive:
<a href="/script-archive-doc/">(docs)</a> : 
<a href="http://wiki.github.com/jakobi/script-archive/">(wiki)</a> : 
<a href="http://github.com/jakobi/script-archive">(git)</a>    &nbsp;|&nbsp;
Android:
<a href="http://jakobi.github.com/android-section/">(articles)</a> 
<a href="http://github.com/jakobi/script-archive/tree/master/android">(files)</a> &nbsp;|&nbsp;
...
</p>

<p class=anno>jakobi(at)acm.org, 2012-01 - 2012-02</p>

</BODY>
</HTML>
