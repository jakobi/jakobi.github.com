<HTML>
<HEAD>
<link rel="icon"          href="/favicon.png"/>
<link rel="shortcut icon" href="/favicon.png"/>
<meta name="description" content="Coping with Android - Setup as a Unix Box: survival unix shell chroot debian ubuntu google android tutorial samsung galaxy note vnc X11 xvnc bash office arm armel">
<meta name="keywords" content="coping android setup as unix box survival shell chroot debian ubuntu google tutorial samsung galaxy note vnc xvnc bash office arm armel">
<meta name="author" content="Peter Jakobi">
<TITLE>Coping with Android - Setup as a Unix Box</TITLE>
<style type="text/css"><!--
   .anno { font-size:.8em }
--></style>
<style type="text/css"><!--
   .num { padding-left:1em; text-align:right; nopadding-right:1em}
   .repo{ text-align:center}
   .file{ nopadding-left:1em; font-family:monospace}
.desc{ padding-left:2em}
--></style>
</HEAD>

<BODY style="background-color:#ffffee">

<p class=anno>
<a href="http://jakobi.github.com/">HOME</a>                                          &nbsp;|&nbsp; 
<a href="http://github.com/jakobi/">GIT Overview</a>          &nbsp;|&nbsp;
Script-Archive:
<a href="/script-archive-doc/">(docs)</a> : 
<a href="http://wiki.github.com/jakobi/script-archive/">(wiki)</a> : 
<a href="http://github.com/jakobi/script-archive">(git)</a>    &nbsp;|&nbsp;
Android:
<a href="http://jakobi.github.com/android-section/">(articles)</a> :
<a href="http://github.com/jakobi/script-archive/tree/master/android">(files)</a> &nbsp;|&nbsp;
...
</p>

<H1>Coping with Android - Setup as a Unix Box</H1>

<hr>

<p>Also                  see                  the                   <a href="http://github.com/jakobi/script-archive/tree/master/android">Android
directory  of  the  script-archive</a>.</p>

<p>Besides some scripts, this directory contains a mothballed snapshot
of  my working Android environment intended to complement the articles
below (android-setup-example-files.tgz).</p>

<p>In  it  you  find the scripts for the Android  shell,  a
collection  of static armel binaries, the tree structure of the chroot
on  the  Galaxy note, as well as scripts and configuration files  used
for monitoring, backup, etc from a remote linux server via cron.</p>

<p>Current  versions of the more interesting scripts will be placed in
above   directory   (if   Android-specific)  or   elsewhere   in   the
script-archive (parts of my bash/ksh setup or generic Unix stuff).</p>



<hr>
<a href="01_setup.html"><H2>01 - Setting  up  the Samsung Galaxy Note as a Unix  Box</H2></a>

<p  class=anno><i>(or  at  least as much as we can get away  with,  given
Google's  Linux kernel  patches and dumbed-down kernel configuration)</i></p>

<H3>Table of contents</H3>
<a name=toc></a>
<ul>
<li><a href="#firstlook">A first look at the Note / Web-Resources / Rooting</a>
<li><a href="#shell">Adding Unix Standards to the Android Shell</a>
<li><a href="#chroot">CHROOT and Turning the Android into a First Class LAN Citizen</a>
<li><a href="#vnc">Desktop and X11</a>
</ul>

<p>
State described: Android 2.3.6 (Gingerbread)<BR>
Last change: 20120216<BR>
License: CC-BY-SA.
</p>



<hr>
<p>Still polishing notes - version 1 to be online before 20120220</p>



<hr>
<a name=firstlook></a>
<H3>A first look at the Note / Web-Resources / Rooting</H3>

<p>This  article  sketches  a sane setup of GNU/Linux on  an  ordinary
<B>1-GB-RAM   DUAL-CORE  PC</B>  (henceforth  to  called   the   armel
architecture  Android device <b>Samsung Galaxy Note</b> GT-N7000).

<p>This is more than enough for a moderate desktop pc that is not used
for  heavy  gaming, virtualization or video editing. In this  article,
I'm     not     interested    in    audio/video    input/output     or
phone/s-pen/sensor/camera  use.</p>


<p>Web Resources of interest:</p>
<ul>
<li><a href="http://www.androidnz.net/2011/12/samsung-galaxy-note-complete-review.html">AndroidNZ review with some app suggestions</a>
<li><a href="http://forum.xda-developers.com/forumdisplay.php?f=1349">XDA Note forum</a>
</ul>


<p>I/O options of the Note include</p>
<ul>
<li>the OTG USB port, which permits to connect
<ul>
<li> the Note to the PC (adb, access to 
    the Note's FAT user filesystems) or
<li> some external USB hardware
    to the Note (Mouse/Keyboard/Memory stick, etc, as long an in-kernel
    driver is available)
<li>the HDMI connection cable (reuses the physical OTG port)
</ul>
<li>acting as either a WLAN-client or a WLAN Access Point
<li>networking over USB
<li>the S-pen - a real wacom-style stylus offering pressure-sensitivity
    and high resolution (not one of those useless iphone-style capacitive 
    finger-tip-replacements; better quality tablet-pc pens work
    on the Note offering both eraser and stylus)
<li>...
</ul>


<p>Flash  considerations:  Choose a <i>quality</i> sdhc microsd
flash, 16  or 32GB. Read speeds for the internal flash are 50+ MB/s and 18MB/s
for  Sandisk.</p>

<p  class=anno>After bad experiences with both Class 10 Transcend  and
Lexar,  I've  now settled on a reliable Sandisk class 4  16GB  microsd
flash.  As Sandisk chooses labels according to the minimum write rate,
it  is nearly as fast as the others. One advantage is that I no longer
find the chroot remounted read-only, as this means to shutdown/restart
the chroot and running fsck (no loss of data though). When switching I
had  a  look at the external sdcard's FAT filesystem and  my  titanium
backup:  Massive  data corruption. Flash problems may well  have  been
worsened  by  whatever timeout changes, etc, Google patched  into  the
kernel.</p>



<p>Power  considerations: to save battery,</p>
<ul>
<li>enable automatic battery savings  in Settings.
<li>turn off WLAN and GPS - the location by cell towers is still
pretty exact. 
<li>if necessary, you can also use titanium backup to freeze
some of the more annoying and power hungry apps in your firmware (kies, socialhub).
</ul>

<p>Known pitfalls to avoid:</p>
<ul>
<li>adb and using symlinks in Android-side paths - silent failure.
<li>bad flash (in all possible senses of the word :)
<li>kies (connectivity suite / flashing windows software provided by Samsung)
<li>use of app2sd: do move all apps to the phone (/data) - the core of
    the Android framework has <B>MAJOR PROBLEMS</B> with apps on sdcards,
    upto and including hanging in a boot-loop (recover by full wipe or
    by adb shell from the PC and removing any packages on the sdcards;
    access by ssh with sshdroid is not possible).
</ul>



<h4>The Whys of Rooting</H4>

Besides  getting faster access to upstream security and bug fixes than
by  waiting for something to trickle down rom Google to Hardware Maker
to Provider to OTA distribution, rooting enables more options for

<ul>
<li>backup/restore
<li>battery management
<li>privacy (LBA, aspotcat, ...; iptables-based "personal" outbound firewalls)
<li>routing (improved tethering and intelligent "routing" at ip route/iptables level)
<li>security (lookout, avast; the ability to create a real iptables-based inbound packet-filter/firewall)
<li>access to non-Android programs, for the Android shell or for a chroot
    maybe containing a full DEBIAN or Ubuntu.
</ul>

Depending  on how you root the device, the flash counter may  increase
(though that <a href="http://forum.xda-developers.com/showthread.php?t=1354888">301K
resistor  field testing jig</a> may help). But in case of mailing  in
the  device, you need to reflash a stock firmware anyway. In  summary:
so what.




<h4>A Sabbatical for Research</h4>

<p>ROMs  are very device specific, so Android ecosystem and  community
are  <i>extremely fragmented</i>: <b>Good community support and custom
roms  are IMHO a pre-requirement when buying Android devices</b>. Some
custom  roms  reuse  stock  kernels, some  use  custom  kernel  builds
(usually   based   on  Android  Open  Source  Project/AOSP;   e.g.
cyanogenmod).</p>

<p   class=anno>Bad  makers  or  lack  of  community  lead  to   early
obsolescence  of the device and wasted money (consider the  disastrous
Motorola  Milestone).  Depending on the number of non-standard  chips,
various firmware-blobs might be required to get a fully working kernel
/  firmware. With some makers not even supporting devices, the initial
release  kernel might well be the only Linux kernel ever working on  a
device  (again the Milestone example). This will also worsen community
support  and  shorten  availability  of community  firmware  for  this
maker's devices (which has to reuse the old buggy kernel). <b>Some</b>
of  this  is visible for the Note as well: the unofficial  CM9  builds
still lack blobs for camera and accelerated display.</p>

<ul>
<li><a href="http://forum.xda-developers.com/forumdisplay.php?f=1349">XDA Note forum</a>
<li><a href="http://sammobile.com" <a>Sammobile</a> (aka samfirmware.com aka samsung-firmwares.com; also contains stock images for reflashing)
<li><a href="http://forum.xda-developers.com/showthread.php?t=1424997">XDA: stock rom list and rom overview</a>
<li><a href="http://cyanogenmod.com">Cyanogenmod</a> and <a href="http://teamhacksung.org/wiki/index.php/Main_Page">teamhacksung</a> (only preliminary unofficial CM7 and CM9 builds for the Note, still lacking some blobs; <a href="http://forum.xda-developers.com/showthread.php?t=1423795&page=52">XDA: cm9</a>)
<li>ROM: <a href="http://forum.xda-developers.com/showthread.php?t=1331784">XDA: Chainfire's CFROOT with CWM (clockworkmod)</a>
<li>ROM: <a href="http://forum.xda-developers.com/showthread.php?t=1352945">Sheeprom</a> by Frank_M aka Riversource
<li>ROM: <a href="http://forum.xda-developers.com/showthread.php?t=1424401">Chris_X roms</a> by Chris_X
<li>Other mentions were villain rom and <a href="http://forum.xda-developers.com/showthread.php?t=1380284">XDA: rocket v13</a>.
</ul>

<p class=anno>(state 201112-201201, Note gingerbread ROMs)</p>



<h4>Pre-Flashing Checklist</h4>


<ul>
<li>create and validate a backup suitable to recover ALL of your device from a 
    barebones custom rom install.
<ul>
   <li>ensure that you have a copy of the /efs contents somewhere (imei, etc)
   <li>consider backups of /mnt/sdcard and /mnt/external_sd.
   <li>consider a backup of /data, even if only <i>tar cf /sdcard/data0.tar /data</i>
   <li>consider using titanium backup to backup user/system apps and data.
   <li>validate your backup!
   <li>consider using cfroot/cwm to do a backup from the recovery rom:
       way faster than titanium to recover the previous state, but not
       that useful on restoring user data into a new custom ROM, as it
       is easy to restore "too much".
   <li>consider copying the backup to your PC! If that happens 
       automatically as part of a nightly backup run, do manually check that copy!
</ul>
<li>ensure that USB-debugging is enabled and adb shell still works
<li>ensure a high battery level
</ul>


<h4>The Way of Rooting (Tourist Travel Sketch, with dog-eared threads)</h4>

<p>At the end of the research phase, you should have selected a target
custom  rom, and maybe one or more intermediate steps if you start out
with  a stock rom. In my case the sequence led from stock back in time
to  a full install of the older KJ1 with CFROOT/CWM, and then  forward
again  to  Chris_X 4lph4 ROMs offering KL8 using the AbyssNote  2.6.35
kernel.</p>

<p><i>Stock to Chainfire KJ1 including the modified factoryfs</i> (see
<a href="http://forum.xda-developers.com/showthread.php?t=1331784">posting
1+2</a>).  If  your  rom doesn't offer CFROOT/CWM, you first  need  to
install  a version of ODIN on Windows that lists the Note as supported
(v3  version 1.83 or 1.85 was the one I found - there doesn't seem  to
be any official home page or author, nor any sane version numbering; a
list        if       provided       e.g.       in       this        <a href="http://droidangel.blogspot.com/2011/05/odin-multi-downloader-flasher-program.html">overview</a>).
For  Linux,  Heimdall  might  work (untested). To set  the  Note  into
download  mode,  use lower-vol + home + power and connect to USB.  For
more detail, check the XDA threads for your selected ROM.</p>

<p><i>Chainfire     KJ1     to    Chris_X    4lph4</i>     (see     <a href="http://forum.xda-developers.com/showthread.php?t=1424401">XDA</a>).
As  we  now  have CFROOT/CWM available, this step no  longer  requires
Windows  and Odin. I repeated this step once to go to a newer ROM from
Chris,  currently  the v1.0.5 from early January which is very  stable
(excluding  Google's  carefully  prepared pitfalls  concerning  shared
memory  and  system_server  vs app2sd). 

<p  class=anno>As of mid February, Chris is at v1.7.</p>

<p  class=anno>I  will  likely  follow him irregularly  until  ICS  is
available  as a CFROOT/CWM supported rom. In the long run, I'll expect
to end up with CM9 or newer.</p>

<p>Notes:</p>
<ul>
<li>entering recovery: CWM application or upper vol + home + power
<li>using CWM to delete the contents of the cache partition and dalvik
cache  is  a  good  idea (the last adds about  15min  to  the  initial
boot).
<li>you may need to be selective in restoring titanium backups: browser 
and market may have different versions, so restoring user data may lead to force crashes.
This fragility is why Chris strongly requires full wipes as part of the install. Note
that restoring 300 user apps takes a whee bit of time.
<li>if you made a CWM Backup before flashing, do not use it as-is from CWM
recovery, as you'd restore the previous state and fully or partially undo
a successful flashing. Though it's perfect to undo a bad flashing or to go back
from testing another ROM.
<li>consider turning off OTA updates (Settings -&gt; About Phone -&gt; 
Software updates). While still pretty rare, Samsung is one of the select
few Android makers that actually publish ROM updates.
</ul>



<h4>Post-Flashing Checklist</H4>

<ul>
<li>check /data/system/uiderrors.txt (chown/chgrp as required as root or try CFROOT's
    fix permissions from the recovery shell; uninstalling all affected apps is another
    option via market or <i>pm uninstall</i> in the shell)
<li>optional: consider doing an immediate fresh-custom-ROM-install backup, maybe 
    as simple as <i>tar cf /sdcard/data1.tar /data</i>, but don't overwrite any of your backups.
<li>optional: copy the backups from the PC back to the Note
<li>(selective) restore of applications (and possibly data) using <i>titanium backup</i>.
<li>use <i>zdbox</i> to move any apps on sdcard back to the phone (there are preference
    settings, but some apps get still always installed to sdcard)
<li>check /data/system/uiderrors.txt again
<li>skim through the Android's settings menu:
<ul>
<li>fix language settings, reenable keyboards(?)
<li>application -&gt; usb debugging still enabled (<i>adb shell</i> command from PC still working?)
<li>power settings
<li>phone: disable OTA software updates
<li>...
</ul>
<li>restore your widgets (<i>quick agenda</i>, <i>floatmemo</i>, <i>coolapps</i>)
<li>check apps that should run on boot / have active schedules (in my case: <i>titanium backup</i>, <i>tasker</i>, 
    <i>lookout</i>, <i>LBE privacy guard</i>, <i>ring guard</i>, <i>smart task switcher</i>)
<li>check <i>terminal ide</i> and root access
<li>from the PC, check the SDK's <i>adb shell</i> access as well as ssh access via <i>sshdroid</i>
<li>check logcat in the shell (is there a need to run insmod /lib/modules/logger.ko or similar?)
<li>rerun sl4a installers (perl apk file is e.g. the installer/uninstaller for perl)
<li>fix your ring and notification tones
<li>check apps (e.g. by <i>titanium backup</i> or by ls /system/app) for applications to 
    disable (<i>titanium backup</i>: freeze)
<li>optional: restore your own modifications to the Android shell and to 
    the <i>terminal ide</i> environment (run INSTALL from part two to recover Android shell 
    modifications, scripts, binaries and symlinks; if lost, do recover the root account 
    for <i>terminal ide</i> from backup)
<li>optional: if already installed: check mc, bash, vi/vim in the shell and in <i>terminal ide</i>
<li>optional: check the availability and functionality of the chroot setup
</ul>

<p>Finally</p>
<ul>
<li>check /data/system/uiderrors.txt again
<li>make  a new backup and copy that to the PC (not  replacing your old one from pre-flash)
</ul>


<h4>Software</h4>

<p>1. Nice to have market apps to improve on Android graphical offerings:</p>
<ul>
<li>apg (an Android frontend for pgp/gpg encrypted files)
<li>aspotcat, lookout, lbe privacy guard (security, permissions, receivers, intents)
<li>clipper, clip ninja, floatmemo (without a window system, we need help to transfer data between apps)
<li>clocksync (to keep your clock in sync with NTP)
<li>coolapps (system load widget and much more)
<li>jota (nice text editor)
<li>k9 (nice mailer)
<li>mobile odin (custom ROM flasher, see also the cwm app, that should be part of of the custom ROM)
<li>printbot, scanthing (printing and scanning, with OCR via update to google docs)
<li>ringguard (don't accidentally change ring tone loudness)
<li>smart taskswitcher, task manager
<li>tasker (programmable android event handling, can substitute for cron, can turn on/off WLAN depending on location, etc)
<li>terminal emulator
<li>zdbox (task killing, moving apps from sdcard to phone)
</ul>

<p  class=anno>(voice recognition and more than word-level handwriting
recognition aren't quite there yet in gingerbread)</p>


<p>2. Required market apps for the rest of this article:</p>
<ul>
<li>busybox installer (stericson, use /system/xbin as installation path)
<li>connectbot (use ssh to connect to remote systems)
<li>file expert or any other filemanager capable of accessing non-sdcard directories
<li>sshdroid (permit incoming ssh connections, dropbear-based)
<li>superuser (usually part of the custom firmware we install)
<li>terminal ide (a pretty complete unix user space for the Android shell)
<li>titanium backup (backup and restore apps, also offers dealing with offending (firmware) apps)
<li>xvnc or vnc viewer
<li>mostly optional: <a href="http://code.google.com/p/android-scripting/">sl4a and perl</a> (perl/python/lua wrapper
    examples are availble for use of the languages in the Android shell; some of my scripts may require perl)
</ul>

<p class=anno>(there  also  are one or two apps that may simplify setting  up  the
chroot   for  sections  3  and  4  of  this  article  (market:   Linux
installer))</p>


<p>3. PC-side applications</p>
<ul>
<li>adb (in the <a href="http://developer.android.com/sdk">Android SDK</a>, tools directory)
</ul>




<!-- ------------------------------------------------------------------------------------- -->
<hr><a href="#toc">(table of contents)</a><hr>
<a name=shell></a>
<H3>Adding Unix Standards to the Android Shell</H3>

<p>Do run and setup each of <i>busybox installer</i>, <i>sshdroid</i>, <i>terminal ide</i>,
<i>titanium  backup</i> and <i>superuser</i> (probably already activated in custom ROMs). From now on, I assume
that</p>

<ul>
<li>you've a Linux PC available (if you want to look at the automation examples incl. nightly backup and monitoring)
<li>grep, sh, etc is available in /system/xbin (<i>stericson busybox installer</i>)
<li>running su, then id in <i>terminal ide</i> show either root or the numerical id 0 (otherwise 
    verify <i>superuser</i>; note that this su is not the real Linux su)
<li>you can run <i>shh root@&lt;WLAN IP of your device&gt;</i> to start an android shell using the dropbear daemon (check <i>sshdroid</i>; 
    your public key goes to /data/data/berserker.android.apps.sshdroid/.ssh/authorized_keys)
</ul>

Further assumptions and settings of my setup (please also check in case of errors):
<ul>
<li>run <i>mount -orw,remount /system</i> as necessary in case of errors 
<li>hostname of the Note is note: <i>hostname note; echo "127.0.0.1 note.compact note "$(getprop net.hostname)" localhost" >> /etc/hosts</i>
<li>DNS lookup is provider-independent: <i>(echo nameserver 8.8.8.8; echo nameserver 8.8.4.4) > /etc/resolv.conf</i>, see also the setprop statements in VPN.
<li>If you see a hardcoded WLAN IP of 192.168.2.114, please replace it with your own Note's WLAN IP. 
<li>/s is a symlink to /mnt/sdcard/COMPACT/setup.
<li>the example home/jakobi/bin/shell/android.func defines some shell aliases to interact with the
    Note from a Linux box: inote, notescp, notessh
</ul>

<p>Please unpack a copy of the <a href="https://github.com/jakobi/script-archive/blob/master/android/android-setup-example-files.tgz?raw=true">example files</a> somewhere (though <b>not in / on your Note</b>). You can check the  <a href="http://github.com/jakobi/script-archive/tree/master/android">Android directory</a> for updated versions, as I will only very infrequently update the tarball. Host.note is an extract of the Note's files, while host.anuurn contains some files from the Linux PC.</p>

<p>If you intend to use my INSTALL script to modify your Android shell
setup,  only  files  below /s (or /mnt/sdcard/COMPACT/setup)  will  be
considered  by INSTALL, so please start with empty /s/data, /s/system,
and  /s/root-tarballs  directories and simply modify and add  scripts,
tarballs  and  configuration, as you proceed through the  article  and
find interesting tidbits. In the example files, the location should be
host.note/mnt/sdcard/COMPACT/setup/INSTALL.</p>


<p><b>ERRATA: rebuild tarball and update INSTALL: old PATH</b></p>


<p>Now that we've taken care of the basics and have access to a rooted
Note,  let's get to the more interesting parts of this article.</p>



<h4>Differences  from  a real Linux system</h4>

libc and its most visible problem: Google reinvented an embedded small
libc  clone  by  the name of bionic, with together  with  the  Android
framework  implements  DNS in a non-standard way. This leads  to  some
confusion  in porting as whether to look at the output of setprop  and
make  quite a few code modifications or just look at the files in /etc
and  hope  that  something (the user...) keeps them in sync  with  the
framework's  properties (setprop/getprop shell command). For  busybox,
the  stericson  version you installed into /system/xbin does  use  DNS
properly,  while  the  versions from <i>sshdroid</i>  and  <i>terminal
ide</i> do not. I defined an alias iresolver to reorder PATH to enable
DNS-related shell commands.</p>

<p>Google   also   reinvented  the  wheel  with  logcat.  Again   with
interesting  effects:  they didn't mangle all parts of the kernel,  so
many  kernel messages never make it to logcat at all. Worse, there  is
no  syslog/klog,  and  messages at best can be seen for a  very  short
period  in a much too noise dmesg output. The lost messages include so
uninteresting topics such as logged packets from user-created iptables
rules.   However,  messages  about  filesystem  data  corruption   are
similarly mistreated. Which just happens to be a <b>severe reliability
issue</b>.  Note that there's nothing in a chroot that can work around
this problem.</p>

<p class=anno>(logcat use may require insmod /lib/modules/logger.ko)</a>

<p>Other   things  that  may  be  unavailable:  Shared  memory.  Again
improperly removed/unconfigured, leading to crashes and the X11 shared
memory  workaround  reported later on. NFS client or  server  support.
The ability to use swap space or swap to file.</p>

<p>The  low power portions of the Google patches neglects to  properly
fix   sleep.   So   without   active  wake_locks   to   avoid   system
suspend-to-ram,  even a one second sleep is completely unreliable  and
may  have  a duration of a few minutes. Large sleeps are affected  way
worse:  Sleeps  aren't ended when the system activates again  and  the
real  time  is  after the intended end of sleep. Thus  a  chroot  cron
becomes  pretty  much unusable without constantly  maintaining  active
wakelocks.    See    the   example   <i>system/xbin/WAKELOCK</i>    to
set/clear/list wake locks.</p>

<p  class=anno>(see e.g. <a href="http://lwn.net/Articles/318611/">LWN:
Wakelocks and the embedded problem</a> - inconsiderate patches such as
these  with  heavy collaterate damage do have a hard time to  make  it
upstream into the Linux kernel sources)</p>



<h4>Notes on Functionality and Commands</h4>

<p>Editing  text:  a  simple vi clone is part of busybox, and  can  be
found  in /system/xbin, and as part of <i>sshdroid</i> and <i>terminal
ide</i>.  A real port of vim is available with <i>terminal ide</i>. On
the graphical side, consider <i>jota</i></p>

<p>I  found  a few working static armel binaries for bash, mc,  rsync,
strace,  tcpdump, and wget. They are included in the example files  in
system/xbin.  Bash and mc are also included with <i>terminal  ide</i>,
but  the terminal-ide mc version lacks sub-shell support. A simplified
wget is also part of busybox.</p>

<p>The shell: sh is part of both busybox and toolbox. As I've run into
a  slew of toolbox bugs, I'd suggest to use /system/xbin/sh. Or  bash,
as mentioned in the previous paragraph. (consider a symlink /bin/bash,
but it's probably better to avoid /bin/sh). Don't mix GNU programs and
busybox  programs within a single pipe hosted by busybox sh  (spurious
output write errors between pipe stages).</p>

<p>To  use  Perl  in the shell, see the system/xbin/perl  example  and
install      sl4a      and      the     perl     apk      from      <a href="http://code.google.com/p/android-scripting/">Scripting Languages
for  Android</a>.  Python  and lua wrappers are also included,  but  I
don't  really use them. In case of <i>sl4a</i> crashes, uninstall  and
reinstall  the  crashing  language.  Consider  creating  the   symlink
/usr/bin/perl  and  adding  /usr/bin  to the  PATH  to  permit  normal
invocation.</p>

<p  class=anno>To use the Android GUI in say ssh scripts, you need the
access  data  from a running "host environment" like <i>sl4a</i>:  run
the  shell  in <i>sl4a</i> and redirect the output of set to  a  file.
Keep open <i>sl4a</i> and set suitable environment variables according
to  the captured output. Maybe also of interest/possibly working as  a
"host":  <i>tasker</i>  and  <i>taskbomb</i> with its  script  support
package (all 3 on market).</p>

<p>Script examples:</p>
<ul>
<li>CHROOT.run (often aliased to x); starts a shell in the chroot or
    run chroot commands as part of a pipe. But more on this will
    have to wait until part 3.
<li>psg is a <i>ps -ef|grep</i> style alias. It also offers to just list
    non standard jobs, or to classify processes as kernel / Android 
    framework/Java / shell or chroot. As busybox doesn't implement ps -ef,
    the script uses busybox top as base.
<li>TERMIDE (often aliased to t): starts a shell in the <i>terminal ide</i> 
    environment as root with suitable settings to access executables and
    profiles as used by <i>terminal ide</i>. Running the app is not required.
<li>TOP augments to output of TOP with various Android specific information
    from watching df, checking that interesting filesystems are still read-write,
    to battery status and cpu frequencies. No interactive top command keys possible.
<li>WAKELOCK is a convenient wrapper used to setup/discard and list wake locks, 
    and used in many of the other scripts.
</ul>



<h4>Treasure Trove Terminal IDE</h4>

<p><i>terminal  ide</i>  aims to attempt to make standard  Unix  setup
available  to permit working with vim and java, thus the <i>IDE in the
terminal</i>  name. This provides the best working environment for the
android shell outside of a chroot. It offers e.g.</p>

<ul>
<li>bash (this lacks subshell/jobs support)
<li>busybox (though lacking DNS-resolving; see the iresolver function or
    temporarily prepend /system/xbin to the PATH)
<li>mc   (this lacks subshell support, consider running the 
   system/xbin/mc binary from the example files or the chroot's <i>x mc -a</i>.
<li>tmux (screen-style terminal multiplexer, configured to use CTRL-a as command key)
<li>vim (_the_ editor)
</ul>

<p>Note  that  an <i>terminal ide</i> bash may block attempts  to  run
<i>mount  -oro,remount /system</i>. /s/INSTALL reliably triggers  that
issue.</p>



<h4>Advanced Networking</h4>

<-- -------------------------^^^ clean \/\/\/ borked ---------------------------------------------------------------- -->

<p>VPN example</p>

<p>Proxies, ssh</p>

<p>VNC</p>

<p>remote files -> later on SSHFS</p>

<p>tethering: just modprobe usbnet and use usb0.
alternately use the ap mode and wlan
proxies: sshtunnel, ORBOT.
</p>


<p><i>proxydroid</i> and <i>sshtunnel</i> - iptables-based forwarding
of requests to a server-based based socks daemon. If you want to setup
your own socks daemon, take a look at the hpsockd.conf in the examples
(as tested once on Ubuntu 10.4).</p>

<p><b>ERRATA: add hpsockd.conf to examples</b></p>

<p>Ssh-client  and  scp  can  be  found  as  part  of  <i>sshdroid</i>
including  sftp server and scp. Another copy is offered by <i>terminal
ide</i>.  A real openssh build is part of <i>sshtunnel</i>, also named
sshtunnel. As android app, consider <i>connectbot</i>. As ssh-server I
use  dropbear  as  provided by <i>sshdroid</i> and only rarely  run  a
second sshd -p <portnumber> in the chroot.</p>

<p>Iptables  is  hopefully part of your custom ROM. Iptables  is  also
part  of <i>proxydroid</i>, <i>sshtunnel</i> and <i>orbot</i> packages
from  market. <i>lbe privacy guard</i> or any of the personal firewall
tools should also contain or offer to install a copy iptables.</p>

<p>Interesting apps</p>
<ul>
</ul>


Script examples:
<ul>
<li>VPN
<li>FW
</ul>




<!-- ------------------------------------------------------------------------------------- -->
<hr><a href="#toc">(table of contents)</a><hr>
<a name=chroot></a>
<H3>CHROOT and Turning the Android into a First Class LAN Citizen</H3>

<pre>


shortcoming: no kernel updates / no security fixes / as 3D/GPU stuff and
e.g. camera often involve binary firmware blobs, choice of kernel is further limited, if you want
to retain access to the by-design-crippled devices.

security  and maintainability is certainly not comparable to a  native
debian install, where the kernel is properly select by grub on boot, as we're restricted
to mere userspace.

---

note: debian or ubuntu armhf port (efficient support of FPU)
I had a look at the new armhf debian architecture to be, but the repo I used was
too incomplete to even survive debootstrap stage 1.

Building  on these basics, the third part looks at taking a  fully
customized  desktop  setup on the road: Create a  Desktop-size  DEBIAN
armel  CHROOT setup and make that a first class citizen in any LAN you
encounter  (ssh, file serving and filesystem mounting).
</pre>



<!-- ------------------------------------------------------------------------------------- -->
<hr><a href="#toc">(table of contents)</a><hr>
<a name=vnc></a>
<H3>Desktop and X11</H3>


<pre>


The  final  step is running a local X11 Desktop on the Note,  using
the  chroot's vncserver or Xvnc (market: Xvnc). To access, either  use
the local display of the Note or any PC with a vncviewer.

This  setup  is  enough  for  normal  LibreOffice  text
editing,   programming  or  some  light  web  browsing  (firefox9  and
chromium-browser  fail,  iceweasel/firefox  3.5 and  the  webkit/gecko
based  browsers  work), even without swap: I've usually  beyond  350MB
free  (free+buffers+cache) before starting X, which is enough for X11,
some xterms, firefox and LibreOffice.

Q: consider some encrypted loop mount ???

My  suspicions  on being very careful wrt using swap: SSD should  have
flash  translation layers (if cheaper flash actually has that at all):
A FAT fielsystem is simle (only the first few blocks are rewritten all
the  time). Database transaction logs are even simpler (all blocks get
rewritten  in sequence, so "wear and tear" is balanced) - both  permit
trivial  flash translation layers, or actually coping without any. Now
swap  and filesystem journals are differing: rist select a semi-random
set of blocks, and then rewrite them all the time.

Suggestion:  enable  swap  with  a very  stringent  swappiness  value;
despite  speed and quality differences, place swap (if at all) on  the
external sdcard, and only activate it when required.



the frequent firmware updates of quality vendors for all early ssd shows the severity of the issues wrt Flash.


</pre>



<!-- ------------------------------------------------------------------------------------- -->
<hr><a href="#toc">(table of contents)</a><hr>
<p>Back to the <a href="index.html">Android Section Overview</a>.</p>

<hr>
<p class=anno>
<a href="http://jakobi.github.com/">HOME</a>                                          &nbsp;|&nbsp; 
<a href="http://github.com/jakobi/">GIT Overview</a>          &nbsp;|&nbsp;
Script-Archive:
<a href="/script-archive-doc/">(docs)</a> : 
<a href="http://wiki.github.com/jakobi/script-archive/">(wiki)</a> : 
<a href="http://github.com/jakobi/script-archive">(git)</a>    &nbsp;|&nbsp;
Android:
<a href="http://jakobi.github.com/android-section/">(articles)</a> 
<a href="http://github.com/jakobi/script-archive/tree/master/android">(files)</a> &nbsp;|&nbsp;
...
</p>

<p class=anno>jakobi(at)acm.org, 2012-01 - 2012-02</p>

</BODY>
</HTML>
